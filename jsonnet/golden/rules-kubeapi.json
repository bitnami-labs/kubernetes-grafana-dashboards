{
   "groups": [
      {
         "name": "kubeapi_rules",
         "rules": [
            {
               "expr": "sum by (job)( kubernetes::job_instance:apiserver_request_errors:ratio_rate5m)",
               "labels": {
                  "job": "kubernetes_api_slo"
               },
               "record": "kubernetes::job:apiserver_request_errors:ratio_rate5m"
            },
            {
               "expr": "sum by (job, instance)( rate(apiserver_request_count{verb!~\"(CONNECT|WATCH|PROXY)\", code=~\"5..\"}[5m])) /sum by (job, instance)( rate(apiserver_request_count[5m]))",
               "labels": {
                  "job": "kubernetes_api_slo"
               },
               "record": "kubernetes::job_instance:apiserver_request_errors:ratio_rate5m"
            },
            {
               "expr": "histogram_quantile ( 0.90, sum by (le, job)( rate(apiserver_request_latencies_bucket{verb!~\"(CONNECT|WATCH|PROXY)\"}[5m]) )) / 1e3",
               "labels": {
                  "job": "kubernetes_api_slo"
               },
               "record": "kubernetes::job:apiserver_latency:pctl90rate5m"
            },
            {
               "expr": "histogram_quantile ( 0.90, sum by (le, job, instance)( rate(apiserver_request_latencies_bucket{verb!~\"(CONNECT|WATCH|PROXY)\"}[5m]) )) / 1e3",
               "labels": {
                  "job": "kubernetes_api_slo"
               },
               "record": "kubernetes::job_instance:apiserver_latency:pctl90rate5m"
            },
            {
               "expr": "sum by()(probe_success{provider=\"kubernetes\", component=\"apiserver\"})",
               "labels": {
                  "job": "kubernetes_api_slo"
               },
               "record": "kubernetes::job:probe_success"
            },
            {
               "expr": "kubernetes::job:apiserver_request_errors:ratio_rate5m < bool 0.01 * kubernetes::job:apiserver_latency:pctl90rate5m < bool 200",
               "labels": {
                  "job": "kubernetes_api_slo"
               },
               "record": "kubernetes::job:slo_kube_api_ok"
            },
            {
               "expr": "kubernetes::job:apiserver_request_errors:ratio_rate5m < bool Inf * kubernetes::job:apiserver_latency:pctl90rate5m < bool Inf",
               "labels": {
                  "job": "kubernetes_api_slo"
               },
               "record": "kubernetes::job:slo_kube_api_sample"
            }
         ]
      }
   ]
}
